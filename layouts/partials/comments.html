<div class="giscus-container">
  <script src="https://giscus.app/client.js"
          data-repo="ByteOfficial/thelowcodebuilder"
          data-repo-id="XXXXXXXXXXXXX"
          data-category="Announcements"
          data-category-id="XXXXXXXXXXXXX"
          data-mapping="pathname"
          data-strict="0"
          data-reactions-enabled="1"
          data-emit-metadata="0"
          data-input-position="bottom"
          data-theme="dark"
          data-lang="en"
          crossorigin="anonymous"
          async>
  </script>
</div>

<script>
  // Function to get current theme
  function getCurrentTheme() {
    // PaperMod stores theme preference in localStorage
    const stored = localStorage.getItem("pref-theme");
    if (stored) return stored === "dark" ? "dark" : "light";

    // Fallback: check body class
    if (document.body.classList.contains("dark")) return "dark";

    // Fallback: check system preference
    if (window.matchMedia("(prefers-color-scheme: dark)").matches) return "dark";

    return "light";
  }

  // Function to set giscus theme
  function setGiscusTheme(theme) {
    const iframe = document.querySelector("iframe.giscus-frame");
    if (!iframe) return;
    iframe.contentWindow.postMessage(
      { giscus: { setConfig: { theme: theme } } },
      "https://giscus.app"
    );
  }

  // Set initial theme once giscus loads
  window.addEventListener("message", function (event) {
    if (event.origin !== "https://giscus.app") return;
    setGiscusTheme(getCurrentTheme());
  });

  // Watch for theme changes (PaperMod toggles class on body)
  const observer = new MutationObserver(function () {
    setGiscusTheme(getCurrentTheme());
  });

  observer.observe(document.body, {
    attributes: true,
    attributeFilter: ["class"],
  });

  // Also watch for localStorage changes (cross-tab support)
  window.addEventListener("storage", function (e) {
    if (e.key === "pref-theme") {
      setGiscusTheme(e.newValue === "dark" ? "dark" : "light");
    }
  });
</script>