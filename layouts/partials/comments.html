<div class="giscus"></div>

<script>
  // Detect current theme
  function getTheme() {
    if (document.body.classList.contains("dark")) {
      return "dark";
    }
    return "light";
  }

  // Load giscus with correct initial theme
  function loadGiscus() {
    const script = document.createElement("script");
    script.src = "https://giscus.app/client.js";
    script.setAttribute("data-repo", "ByteOfficial/thelowcodebuilder");
    script.setAttribute("data-repo-id", "R_kgDORV1QAw");          // ← Your repo ID
    script.setAttribute("data-category", "Announcements");
    script.setAttribute("data-category-id", "DIC_kwDORV1QA84C3E0l");      // ← Your category ID
    script.setAttribute("data-mapping", "pathname");
    script.setAttribute("data-strict", "0");
    script.setAttribute("data-reactions-enabled", "1");
    script.setAttribute("data-emit-metadata", "0");
    script.setAttribute("data-input-position", "bottom");
    script.setAttribute("data-theme", getTheme());                 // ← Dynamic!
    script.setAttribute("data-lang", "en");
    script.setAttribute("crossorigin", "anonymous");
    script.async = true;
    document.querySelector(".giscus").appendChild(script);
  }

  loadGiscus();

  // Update giscus theme when toggled
  function setGiscusTheme(theme) {
    const iframe = document.querySelector("iframe.giscus-frame");
    if (!iframe) return;
    iframe.contentWindow.postMessage(
      { giscus: { setConfig: { theme: theme } } },
      "https://giscus.app"
    );
  }

  // Hook into PaperMod's theme toggle button
  const toggle = document.getElementById("theme-toggle");
  if (toggle) {
    toggle.addEventListener("click", function () {
      // Small delay to let PaperMod toggle the class first
      setTimeout(function () {
        setGiscusTheme(getTheme());
      }, 50);
    });
  }

  // Also watch for body class changes (backup method)
  const observer = new MutationObserver(function () {
    setGiscusTheme(getTheme());
  });

  observer.observe(document.body, {
    attributes: true,
    attributeFilter: ["class"],
  });

  // Handle system theme changes
  window
    .matchMedia("(prefers-color-scheme: dark)")
    .addEventListener("change", function (e) {
      setGiscusTheme(e.matches ? "dark" : "light");
    });
</script>